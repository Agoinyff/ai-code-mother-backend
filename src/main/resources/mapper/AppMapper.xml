<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yff.aicodemother.mapper.AppMapper">

    <resultMap id="BaseResultMap" type="com.yff.aicodemother.model.entity.App">
            <id property="id" column="id" jdbcType="BIGINT"/>
            <result property="appName" column="appName" jdbcType="VARCHAR"/>
            <result property="cover" column="cover" jdbcType="VARCHAR"/>
            <result property="initPrompt" column="initPrompt" jdbcType="VARCHAR"/>
            <result property="codeGenType" column="codeGenType" jdbcType="VARCHAR"/>
            <result property="deployKey" column="deployKey" jdbcType="VARCHAR"/>
            <result property="deployedTime" column="deployedTime" jdbcType="TIMESTAMP"/>
            <result property="priority" column="priority" jdbcType="INTEGER"/>
            <result property="userId" column="userId" jdbcType="BIGINT"/>
            <result property="editTime" column="editTime" jdbcType="TIMESTAMP"/>
            <result property="createTime" column="createTime" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="updateTime" jdbcType="TIMESTAMP"/>
            <result property="isDelete" column="isDelete" jdbcType="TINYINT"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,appName,cover,
        initPrompt,codeGenType,deployKey,
        deployedTime,priority,userId,
        editTime,createTime,updateTime,
        isDelete
    </sql>

    <!-- 分页查询用户自己的应用列表 -->
    <select id="selectMyAppVoPage" resultType="com.yff.aicodemother.model.vo.AppVo">
        SELECT
            id, appName, cover, initPrompt, codeGenType,
            deployKey, deployedTime, priority,
            userId, createTime, updateTime
        FROM app
        <where>
            isDelete = 0
            AND userId = #{userId}
            <if test="query.appName != null and query.appName != ''">
                AND appName LIKE CONCAT('%', #{query.appName}, '%')
            </if>
        </where>
        ORDER BY createTime DESC
    </select>

    <!-- 分页查询精选应用列表 -->
    <!-- 分页查询精选应用列表（priority=99表示精选） -->
    <select id="selectFeaturedAppVoPage" resultType="com.yff.aicodemother.model.vo.AppVo">
        SELECT
            id, appName, cover, initPrompt, codeGenType,
            deployKey, deployedTime, priority,
            userId, createTime, updateTime
        FROM app
        <where>
            isDelete = 0
            AND priority = 99
            <if test="query.appName != null and query.appName != ''">
                AND appName LIKE CONCAT('%', #{query.appName}, '%')
            </if>
        </where>
        ORDER BY createTime DESC
    </select>

    <!-- 管理员分页查询应用列表 -->
    <select id="selectAppVoPageForAdmin" resultType="com.yff.aicodemother.model.vo.AppVo">
        SELECT
            id, appName, cover, initPrompt, codeGenType,
            deployKey, deployedTime, priority,
            userId, createTime, updateTime
        FROM app
        <where>
            isDelete = 0
            <if test="query.id != null">
                AND id = #{query.id}
            </if>
            <if test="query.appName != null and query.appName != ''">
                AND appName LIKE CONCAT('%', #{query.appName}, '%')
            </if>
            <if test="query.cover != null and query.cover != ''">
                AND cover LIKE CONCAT('%', #{query.cover}, '%')
            </if>
            <if test="query.initPrompt != null and query.initPrompt != ''">
                AND initPrompt LIKE CONCAT('%', #{query.initPrompt}, '%')
            </if>
            <if test="query.codeGenType != null and query.codeGenType != ''">
                AND codeGenType = #{query.codeGenType}
            </if>
            <if test="query.deployKey != null and query.deployKey != ''">
                AND deployKey = #{query.deployKey}
            </if>
            <if test="query.priority != null">
                AND priority = #{query.priority}
            </if>

            <if test="query.userId != null">
                AND userId = #{query.userId}
            </if>
        </where>
        ORDER BY createTime DESC
    </select>

</mapper>

